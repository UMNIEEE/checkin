<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
    <title>Meeting Check-In</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700|Oswald:300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="../Content/Site.css">
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style>
        .col-lg-offset-4 {
            margin-left: 30%;
        }
        .col-lg-4 {
            width: 40.0%;
            }
    </style>
</head>
<body>

    <div class="container">
        <div class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
            <h1 class="pre-header" id="topHeader">University of Minnesota</h1>
            <img class="logo" id="logoImage" src="../Images/logo.svg">
            <h1 class="post-header">Meeting Check-In</h1>

            <p class="section-header">Meeting Options <i class="fa fa-list"></i></p>  
            <!-- Insert action to redirect to checkin.php -->
            <form class="boxed-section margin-lg-after" id="meetingForm">
                <p class="section-label">Select Exisiting Meeting<i class="fa fa-calendar-o"></i></p>
                <select class="selectpicker" id="meetingDropdown" name="meeting"></select>
                <p class="section-label">Create New Meeting<i class="fa fa-pencil"></i></p>
                <input class="form-control input-lg margin-sm-after" type="text" id="newmeeting" placeholder="Meeting Name">
                <button class="form-control input-lg btn btn-info check-in" id="meetingButton" onclick="return meetingSubmit();" type="submit" ><i class="fa fa-check"></i>New Meeting</button>
            </form>
            <!-- Button to Post selection -->

            <p class="section-header">View Meeting Attendance <i class="fa fa-file-text"></i></p> 
            <form id="form1" class="boxed-section margin-lg-after" role="form">
                <p class="section-label">Filter Meetings<i class="fa fa-filter"></i></p>
                <select class="selectpicker" id="ouputDropdown" name="meeting"></select>
                <!--<input class="form-control input-lg margin-sm-after" type="text" id="meetingSearch" placeholder="Meeting Name">-->
                <button class="form-control input-lg btn btn-info check-in" onclick="return outputSubmit();" type="submit" id="outputbutton" name="outputbutton"><i class="fa fa-check"></i>View</button>
            </form>

            <p class="section-header">Clear Attendance <i class="fa fa-eraser"></i></p>
            <form id="form2" class="boxed-section margin-lg-after" role="form">
                <p class="section-label">Filter Meetings<i class="fa fa-filter"></i></p>
                <select class="selectpicker" id="clearDropdown" name="meeting"></select>
                <button class="form-control input-lg btn btn-info check-in" onclick="return clearSubmit();" type="submit" id="Button1" name="outputbutton"><i class="fa fa-check"></i>Clear</button>
            </form>

            <p class="section-header">Format Appearance <i class="fa fa-cogs"></i></p>
            <form id="form3" class="boxed-section margin-lg-after" role="form">
                <button class="form-control input-lg btn btn-info check-in" onclick="return formatSubmit();" type="submit" id="Button2" name="outputbutton"><i class="fa fa-check"></i>Format</button>
            </form>

            <p class="section-header">About <i class="fa fa-info-circle"></i></p>
            <form id="form4" class="boxed-section margin-lg-after" role="form">
                <button class="form-control input-lg btn btn-info check-in" onclick="return aboutSubmit();" type="submit" id="Button3" name="outputbutton"><i class="fa fa-check"></i>About</button>
            </form>

            <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
            <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
            <script src="../Scripts/jquery.cookie.js"></script>
            <script src="../Scripts/check-in.js"></script>
            <script src="../Scripts/umn-crawl.js"></script>
            <script src="../Scripts/store.js"></script>
            <script src="../Scripts/format.js"></script>
            <script>
                $(document).ready(function () {
                    $("#newmeeting").keydown(function (event) {
                        if (event.keyCode == 13) {
                            meetingSubmit()
                        }
                    });
                    $("#meetingSearch").keydown(function (event) {
                        if (event.keyCode == 13) {
                            outputSubmit()
                        }
                    });
                    $("#meetingClear").keydown(function (event) {
                        if (event.keyCode == 13) {
                            clearSubmit()
                        }
                    });
                    
                });
                function dbOpenCallback() {
                    try {
                        getMeetings();
                    }
                    catch (err) {
                        alert(err.message);
                    }
                }
                function meetingCallback(meetings) {
                    var htmlVal = "";
                    for(var i = 0; i < meetings.length; i++) {
                        htmlVal = htmlVal + "<option value='" + "meeting=" + meetings[i].meeting + "&" + "date=" + meetings[i].date + "'>" + meetings[i].meeting + " " + meetings[i].date + "</option>";
                    }

                    $("#meetingDropdown").html(htmlVal);

                    var htmlVal = "<option value='meeting=&date='>All Meetings</option>" + htmlVal;
                    $("#ouputDropdown").html(htmlVal);
                    $("#clearDropdown").html(htmlVal);
                }

                function meetingSubmit() {
                    var newUrl = "";
                    var meeting = $("#newmeeting").val();
                    var meetingDrop = $("#meetingDropdown option:selected").val()
                    if (meeting === null || meeting === undefined || meeting.trim() === "" && meetingDrop !== null && meetingDrop !== undefined && meetingDrop.trim() !== "") {
                        var meetUrl = $("#meetingDropdown option:selected").val().trim();
                        var meet = "";
                        var date = "";

                        var sURLVariables = meetUrl.split('&');
                        for (var i = 0; i < sURLVariables.length; i++) {
                            var sParameterName = sURLVariables[i].split('=');
                            if (sParameterName[0] == "meeting") {
                                meet = sParameterName[1];
                            }
                        }
                        for (var i = 0; i < sURLVariables.length; i++) {
                            var sParameterName = sURLVariables[i].split('=');
                            if (sParameterName[0] == "date") {
                                date = sParameterName[1];
                            }
                        }
                    }
                    else if($("#newmeeting").val() !== null && $("#newmeeting").val() !== undefined && $("#newmeeting").val().trim() !== ""){
                        var dt = new Date();
                        date = dt.getFullYear() + "-" + dt.getMonth() + "-" + dt.getDate();
                        meet = $("#newmeeting").val().trim();
                    }
                    else {
                        alert("Must select a meeting or create a new meeting.");
                        return false;
                    }

                    newUrl = encodeURI("meeting=" + meet + "&date=" + date);
                    $("#newmeeting").val("");
                    window.location.href = "checkin.html?" + newUrl;

                    return false;
                }
                function outputSubmit() {
                    var meet = encodeURI($("#ouputDropdown option:selected").val().trim());
                    var newUrl = "output.html";
                    if (meet != null && meet.trim() != "")
                        newUrl = newUrl + "?" + meet;

                    window.location.href = newUrl;

                    return false;
                }
                function clearSubmit() {
                    var meetUrl = $("#clearDropdown option:selected").val().trim();
                    var meet = "";
                    var date = "";

                    var sURLVariables = meetUrl.split('&');
                    for (var i = 0; i < sURLVariables.length; i++) {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == "meeting") {
                            meet = sParameterName[1];
                        }
                    }
                    for (var i = 0; i < sURLVariables.length; i++) {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == "date") {
                            date = sParameterName[1];
                        }
                    }

                    var msg = "Are you sure you want to clear '";
                    if (meet != null && meet.trim() != "")
                        msg = msg + meet.trim() + "'?";
                    else
                        msg = msg + "All'?"

                    var r = confirm(msg);
                    if (r == true) {
                        try {
                            if ((meet != null && date != null) && (meet.trim() != "" && date.trim() != ""))
                                deleteItems(meet.trim(), date.trim());
                            else
                                clearData();
                        }
                        catch (err) {
                            alert(err.message);
                        }
                    }

                    return false;
                }
                function formatSubmit() {
                    window.location.href = "format.html";
                    return false;
                }
                function aboutSubmit() {
                    window.location.href = "about.html";
                    return false;
                }
            </script>
            <p class="footer"></p>
        </div>
    </div>
</body>
</html>
